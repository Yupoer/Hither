//
//  EmojiAvatarPicker.swift
//  Hither
//
//  Created by Claude on 2025/7/29.
//

import SwiftUI

struct EmojiAvatarPicker: View {
    @Environment(\.presentationMode) var presentationMode
    @State private var selectedEmoji: String?
    
    let currentEmoji: String?
    let onEmojiSelected: (String?) -> Void
    
    private let emojiCategories: [(title: String, emojis: [String])] = [
        ("People", ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜Š", "ğŸ˜‡", "ğŸ™‚", "ğŸ™ƒ", "ğŸ˜‰", "ğŸ˜Œ", "ğŸ˜", "ğŸ¥°", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜™", "ğŸ˜š", "ğŸ˜‹", "ğŸ˜›", "ğŸ˜", "ğŸ˜œ", "ğŸ¤ª", "ğŸ¤¨", "ğŸ§", "ğŸ¤“", "ğŸ˜", "ğŸ¤©", "ğŸ¥³", "ğŸ˜", "ğŸ˜’", "ğŸ˜", "ğŸ˜”", "ğŸ˜Ÿ", "ğŸ˜•", "ğŸ™", "â˜¹ï¸", "ğŸ˜£", "ğŸ˜–", "ğŸ˜«", "ğŸ˜©", "ğŸ¥º", "ğŸ˜¢", "ğŸ˜­", "ğŸ˜¤", "ğŸ˜ ", "ğŸ˜¡", "ğŸ¤¬", "ğŸ¤¯", "ğŸ˜³", "ğŸ¥µ", "ğŸ¥¶", "ğŸ˜±", "ğŸ˜¨", "ğŸ˜°", "ğŸ˜¥", "ğŸ˜“", "ğŸ¤—", "ğŸ¤”", "ğŸ¤­", "ğŸ¤«", "ğŸ¤¥", "ğŸ˜¶", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¬", "ğŸ™„", "ğŸ˜¯", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜®", "ğŸ˜²", "ğŸ¥±", "ğŸ˜´", "ğŸ¤¤", "ğŸ˜ª", "ğŸ˜µ", "ğŸ¤", "ğŸ¥´", "ğŸ¤¢", "ğŸ¤®", "ğŸ¤§", "ğŸ˜·", "ğŸ¤’", "ğŸ¤•"]),
        ("Animals", ["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ½", "ğŸ¸", "ğŸµ", "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "ğŸ’", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£", "ğŸ¥", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ", "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦", "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡", "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…", "ğŸ†", "ğŸ¦“", "ğŸ¦", "ğŸ¦§", "ğŸ˜", "ğŸ¦›", "ğŸ¦", "ğŸª", "ğŸ«", "ğŸ¦’", "ğŸ¦˜", "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸ", "ğŸ–", "ğŸ", "ğŸ‘", "ğŸ¦™", "ğŸ", "ğŸ¦Œ", "ğŸ•", "ğŸ©", "ğŸ¦®", "ğŸ•â€ğŸ¦º", "ğŸˆ", "ğŸ“", "ğŸ¦ƒ", "ğŸ¦š", "ğŸ¦œ", "ğŸ¦¢", "ğŸ¦©", "ğŸ•Šï¸", "ğŸ‡", "ğŸ¦", "ğŸ¦¨", "ğŸ¦”", "ğŸ¦¦", "ğŸ¦¥", "ğŸ", "ğŸ€", "ğŸ¿ï¸"]),
        ("Nature", ["ğŸŒ±", "ğŸŒ¿", "ğŸ€", "ğŸƒ", "ğŸ‚", "ğŸ", "ğŸŒ¾", "ğŸŒ»", "ğŸŒº", "ğŸŒ¸", "ğŸŒ¼", "ğŸŒ·", "ğŸ¥€", "ğŸŒ¹", "ğŸµï¸", "ğŸŒµ", "ğŸ„", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´", "ğŸ‹", "ğŸ", "ğŸŒŠ", "ğŸ’§", "ğŸ”¥", "â­", "ğŸŒŸ", "âœ¨", "âš¡", "â˜„ï¸", "ğŸ’«", "ğŸŒ™", "â˜€ï¸", "ğŸŒ¤ï¸", "â›…", "ğŸŒ¦ï¸", "ğŸŒ§ï¸", "â›ˆï¸", "ğŸŒ©ï¸", "ğŸŒ¨ï¸", "â„ï¸", "â˜ƒï¸", "â›„", "ğŸŒ¬ï¸", "ğŸ’¨", "ğŸŒªï¸", "ğŸŒˆ", "â˜‚ï¸", "â˜”", "â›±ï¸", "âš¡", "ğŸ”¥", "ğŸ’§", "ğŸŒŠ"]),
        ("Food", ["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ«", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸ«‘", "ğŸŒ½", "ğŸ¥•", "ğŸ«’", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥–", "ğŸ", "ğŸ¥¨", "ğŸ¥¯", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡", "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸ¦´", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•", "ğŸ«“", "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ«”", "ğŸ¥—", "ğŸ¥˜", "ğŸ«•", "ğŸ¥«", "ğŸ", "ğŸœ", "ğŸ²", "ğŸ›", "ğŸ£", "ğŸ±", "ğŸ¥Ÿ", "ğŸ¦ª", "ğŸ¤", "ğŸ™", "ğŸš", "ğŸ˜", "ğŸ¥", "ğŸ¥ ", "ğŸ¥®", "ğŸ¢", "ğŸ¡", "ğŸ§", "ğŸ¨", "ğŸ¦", "ğŸ¥§", "ğŸ§", "ğŸ°", "ğŸ‚", "ğŸ®", "ğŸ­", "ğŸ¬", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸŒ°", "ğŸ¥œ", "ğŸ¯"]),
        ("Activities", ["âš½", "ğŸ€", "ğŸˆ", "âš¾", "ğŸ¥", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ¥", "ğŸ±", "ğŸª€", "ğŸ“", "ğŸ¸", "ğŸ’", "ğŸ‘", "ğŸ¥", "ğŸ", "ğŸªƒ", "ğŸ¥…", "â›³", "ğŸª", "ğŸ¹", "ğŸ£", "ğŸ¤¿", "ğŸ¥Š", "ğŸ¥‹", "ğŸ½", "ğŸ›¹", "ğŸ›·", "â›¸ï¸", "ğŸ¥Œ", "ğŸ¿", "â›·ï¸", "ğŸ‚", "ğŸª‚", "ğŸ‹ï¸â€â™€ï¸", "ğŸ‹ï¸", "ğŸ‹ï¸â€â™‚ï¸", "ğŸ¤¼â€â™€ï¸", "ğŸ¤¼", "ğŸ¤¼â€â™‚ï¸", "ğŸ¤¸â€â™€ï¸", "ğŸ¤¸", "ğŸ¤¸â€â™‚ï¸", "â›¹ï¸â€â™€ï¸", "â›¹ï¸", "â›¹ï¸â€â™‚ï¸", "ğŸ¤º", "ğŸ¤¾â€â™€ï¸", "ğŸ¤¾", "ğŸ¤¾â€â™‚ï¸", "ğŸŒï¸â€â™€ï¸", "ğŸŒï¸", "ğŸŒï¸â€â™‚ï¸", "ğŸ§˜â€â™€ï¸", "ğŸ§˜", "ğŸ§˜â€â™‚ï¸", "ğŸ„â€â™€ï¸", "ğŸ„", "ğŸ„â€â™‚ï¸", "ğŸŠâ€â™€ï¸", "ğŸŠ", "ğŸŠâ€â™‚ï¸", "ğŸ¤½â€â™€ï¸", "ğŸ¤½", "ğŸ¤½â€â™‚ï¸", "ğŸš£â€â™€ï¸", "ğŸš£", "ğŸš£â€â™‚ï¸", "ğŸ§—â€â™€ï¸", "ğŸ§—", "ğŸ§—â€â™‚ï¸", "ğŸšµâ€â™€ï¸", "ğŸšµ", "ğŸšµâ€â™‚ï¸", "ğŸš´â€â™€ï¸", "ğŸš´", "ğŸš´â€â™‚ï¸", "ğŸ‡", "ğŸ§‘â€ğŸ¦½", "ğŸ‘¨â€ğŸ¦½", "ğŸ‘©â€ğŸ¦½", "ğŸ§‘â€ğŸ¦¼", "ğŸ‘¨â€ğŸ¦¼", "ğŸ‘©â€ğŸ¦¼", "ğŸƒâ€â™€ï¸", "ğŸƒ", "ğŸƒâ€â™‚ï¸", "ğŸš¶â€â™€ï¸", "ğŸš¶", "ğŸš¶â€â™‚ï¸"]),
        ("Travel", ["ğŸš—", "ğŸš•", "ğŸš™", "ğŸšŒ", "ğŸš", "ğŸï¸", "ğŸš“", "ğŸš‘", "ğŸš’", "ğŸš", "ğŸ›»", "ğŸšš", "ğŸš›", "ğŸšœ", "ğŸï¸", "ğŸ›µ", "ğŸš²", "ğŸ›´", "ğŸ›¹", "ğŸ›¼", "ğŸš", "ğŸ›¸", "âœˆï¸", "ğŸ›©ï¸", "ğŸ›«", "ğŸ›¬", "ğŸª‚", "ğŸ’º", "ğŸš€", "ğŸ›°ï¸", "ğŸš¢", "â›µ", "ğŸš¤", "ğŸ›¥ï¸", "ğŸ›³ï¸", "â›´ï¸", "ğŸš‚", "ğŸšƒ", "ğŸš„", "ğŸš…", "ğŸš†", "ğŸš‡", "ğŸšˆ", "ğŸš‰", "ğŸšŠ", "ğŸš", "ğŸš", "ğŸš‹", "ğŸšŒ", "ğŸš", "ğŸš", "ğŸš", "ğŸš‘", "ğŸš’", "ğŸš“", "ğŸš”", "ğŸš•", "ğŸš–", "ğŸš—", "ğŸš˜", "ğŸš™", "ğŸšš", "ğŸš›", "ğŸšœ", "ğŸï¸", "ğŸï¸", "ğŸ›µ", "ğŸ¦½", "ğŸ¦¼", "ğŸ›´", "ğŸš²", "ğŸ›¹", "ğŸ›¼", "ğŸš", "ğŸ›¸", "âœˆï¸", "ğŸ›©ï¸", "ğŸ›«", "ğŸ›¬", "ğŸª‚", "ğŸ’º", "ğŸš€", "ğŸ›°ï¸"]),
        ("Objects", ["âŒš", "ğŸ“±", "ğŸ“²", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸", "ğŸ•¹ï¸", "ğŸ—œï¸", "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹", "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º", "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°", "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦", "ğŸ•¯ï¸", "ğŸª”", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·", "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸", "ğŸ› ï¸", "â›ï¸", "ğŸ”©", "âš™ï¸", "ğŸ§±", "â›“ï¸", "ğŸ§²", "ğŸ”«", "ğŸ’£", "ğŸ§¨", "ğŸª“", "ğŸ”ª", "ğŸ—¡ï¸", "âš”ï¸", "ğŸ›¡ï¸", "ğŸš¬", "âš°ï¸", "âš±ï¸", "ğŸº", "ğŸ”®", "ğŸ“¿", "ğŸ§¿", "ğŸ’ˆ", "âš—ï¸", "ğŸ”­", "ğŸ”¬", "ğŸ•³ï¸", "ğŸ©¹", "ğŸ©º", "ğŸ’Š", "ğŸ’‰", "ğŸ§¬", "ğŸ¦ ", "ğŸ§«", "ğŸ§ª", "ğŸŒ¡ï¸", "ğŸ§¹", "ğŸ§º", "ğŸ§»", "ğŸš½", "ğŸš°", "ğŸš¿", "ğŸ›", "ğŸ›€", "ğŸ§¼", "ğŸª’", "ğŸ§½", "ğŸ§´", "ğŸ›ï¸", "ğŸ”‘", "ğŸ—ï¸", "ğŸšª", "ğŸª‘", "ğŸ›ï¸", "ğŸ›‹ï¸", "ğŸª", "ğŸš¨", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ›’"]),
        ("Symbols", ["â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤", "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–", "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸", "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ", "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™", "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸", "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸", "ğŸ†š", "ğŸ’®", "ğŸ‰", "ãŠ™ï¸", "ãŠ—ï¸", "ğŸˆ´", "ğŸˆµ", "ğŸˆ¹", "ğŸˆ²", "ğŸ…°ï¸", "ğŸ…±ï¸", "ğŸ†", "ğŸ†‘", "ğŸ…¾ï¸", "ğŸ†˜", "âŒ", "â­•", "ğŸ›‘", "â›”", "ğŸ“›", "ğŸš«", "ğŸ’¯", "ğŸ’¢", "â™¨ï¸", "ğŸš·", "ğŸš¯", "ğŸš³", "ğŸš±", "ğŸ”", "ğŸ“µ", "ğŸš­", "â—", "â•", "â“", "â”", "â€¼ï¸", "â‰ï¸", "ğŸ”…", "ğŸ”†", "ã€½ï¸", "âš ï¸", "ğŸš¸", "ğŸ”±", "âšœï¸", "ğŸ”°", "â™»ï¸", "âœ…", "ğŸˆ¯", "ğŸ’¹", "â‡ï¸", "âœ³ï¸", "â", "ğŸŒ", "ğŸ’ ", "â“‚ï¸", "ğŸŒ€", "ğŸ’¤", "ğŸ§", "ğŸš¾", "â™¿", "ğŸ…¿ï¸", "ğŸˆ³", "ğŸˆ‚ï¸", "ğŸ›‚", "ğŸ›ƒ", "ğŸ›„", "ğŸ›…", "ğŸš¹", "ğŸšº", "ğŸš¼", "ğŸš»", "ğŸš®", "ğŸ¦", "ğŸ“¶", "ğŸˆ", "ğŸ”£", "â„¹ï¸", "ğŸ”¤", "ğŸ”¡", "ğŸ” ", "ğŸ†–", "ğŸ†—", "ğŸ†™", "ğŸ†’", "ğŸ†•", "ğŸ†“", "0ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "4ï¸âƒ£", "5ï¸âƒ£", "6ï¸âƒ£", "7ï¸âƒ£", "8ï¸âƒ£", "9ï¸âƒ£", "ğŸ”Ÿ"])
    ]
    
    var body: some View {
        NavigationView {
            ScrollView {
                LazyVStack(alignment: .leading, spacing: 20) {
                    // No emoji option
                    VStack(alignment: .leading, spacing: 12) {
                        HStack {
                            Text("No Avatar")
                                .font(.headline)
                            Spacer()
                        }
                        
                        Button(action: {
                            selectedEmoji = nil
                            onEmojiSelected(nil)
                            presentationMode.wrappedValue.dismiss()
                        }) {
                            HStack {
                                Image(systemName: "person.circle")
                                    .font(.title2)
                                    .foregroundColor(.gray)
                                Text("Use default avatar")
                                    .foregroundColor(.primary)
                                Spacer()
                                if currentEmoji == nil {
                                    Image(systemName: "checkmark")
                                        .foregroundColor(.blue)
                                }
                            }
                            .padding()
                            .background(currentEmoji == nil ? Color.blue.opacity(0.1) : Color.clear)
                            .cornerRadius(8)
                            .overlay(
                                RoundedRectangle(cornerRadius: 8)
                                    .stroke(currentEmoji == nil ? Color.blue : Color.gray.opacity(0.3), lineWidth: 1)
                            )
                        }
                        .buttonStyle(PlainButtonStyle())
                    }
                    .padding(.horizontal)
                    
                    // Emoji categories
                    ForEach(emojiCategories, id: \.title) { category in
                        VStack(alignment: .leading, spacing: 12) {
                            HStack {
                                Text(category.title)
                                    .font(.headline)
                                Spacer()
                            }
                            .padding(.horizontal)
                            
                            LazyVGrid(columns: Array(repeating: GridItem(.flexible()), count: 8), spacing: 8) {
                                ForEach(category.emojis, id: \.self) { emoji in
                                    Button(action: {
                                        selectedEmoji = emoji
                                        onEmojiSelected(emoji)
                                        presentationMode.wrappedValue.dismiss()
                                    }) {
                                        Text(emoji)
                                            .font(.title2)
                                            .frame(width: 40, height: 40)
                                            .background(currentEmoji == emoji ? Color.blue.opacity(0.2) : Color.clear)
                                            .cornerRadius(8)
                                            .overlay(
                                                RoundedRectangle(cornerRadius: 8)
                                                    .stroke(currentEmoji == emoji ? Color.blue : Color.clear, lineWidth: 2)
                                            )
                                    }
                                    .buttonStyle(PlainButtonStyle())
                                }
                            }
                            .padding(.horizontal)
                        }
                    }
                }
                .padding(.vertical)
            }
            .navigationTitle("Choose Avatar")
            .navigationBarTitleDisplayMode(.inline)
            .navigationBarItems(
                leading: Button("Cancel") {
                    presentationMode.wrappedValue.dismiss()
                }
            )
        }
    }
}

struct EmojiAvatarPicker_Previews: PreviewProvider {
    static var previews: some View {
        EmojiAvatarPicker(currentEmoji: "ğŸ˜€") { emoji in
            print("Selected emoji: \(emoji ?? "none")")
        }
    }
}